var AnimatedSprite=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(){function t(e,t,n,i,a,r){var s,o=90*(Math.PI/180),c=this,u=t,f=n,v=i,h=a,d=r||{},p=d.dontClear,l=Math.floor(u.width/f)-1,y="canvas"===e.tagName.toLowerCase(),g=y?e:((s=document.createElement("canvas")).width=d.canvasW||f,s.height=d.canvasH||v,s.style.position="absolute",e.appendChild(s),s),E=g.getContext("2d"),w=[];if("function"!=typeof window.Event){var m=function(e,t){t=t||{bubbles:!1,cancelable:!1};var n=document.createEvent("Event");return n.initEvent(e,t.bubbles,t.cancelable),n};m.prototype=window.Event.prototype,window.Event=m}var b,C=0,k=-1,R=0,L=0,M=1,A=1,I=0,P=!1,T=0,x=!1,F=!1,N=!1,j=!1,q=!1,D=d.offsetX||0,H=d.offsetY||0;this.canvas=g;var O=new Event("playing"),S=new Event("paused"),U=new Event("ended"),W=new Event("forward"),X=new Event("backward"),Y=new Event("fpschange"),z=[];p&&(z.length=h+1);for(var B=0,G=0;B<h;)w.push({x:f*R,y:v*L}),R<l?R++:R=0,G++,L=Math.floor(G/(l+1)),B++;function J(){P||(P=!0,x=!0,Q(),g.dispatchEvent(O))}function K(){cancelAnimationFrame(b),P=!1,x=!1,g.dispatchEvent(S)}function Q(e){if(T!==e){if(T=e,0===(I=M%A))!function(){p&&!z[C]&&(z[C]=new Image,z[C].src=g.toDataURL());C>h-2&&!q?(K(),F=!0,g.dispatchEvent(U),c.onComplete&&c.onComplete()):C<1&&q?(K(),F=!0,g.dispatchEvent(U)):(q?(C--,k=C-1):(C++,k=C+1),p&&!q||E.clearRect(D,H,f,v))}(),V(C),1;else if(N)if(j){var t=I/A*o;V(C,Math.cos(t),!0),V(k,Math.sin(t))}else V(k,1===I?1/A:1/A*2);M++,!0===x&&(b=requestAnimationFrame(Q))}}function V(e,t,n){w[e]&&(E.globalAlpha=t||1,n&&E.clearRect(D,H,f,v),z[e]?E.drawImage(z[e],0,0,f,v,D,H,f,v):E.drawImage(u,w[e].x,w[e].y,f,v,D,H,f,v))}R=L=0,this.getCrossfade=function(){return N},this.setCrossfade=function(e){N=e},this.getTransparency=function(){return j},this.setTransparency=function(e){e||(g.style.opacity=1),j=e},this.initCrossfade=function(){N=!0},this.getPlaying=function(){return x},this.getEvery=function(){return A},this.setEvery=function(e){var t=Math.round(e);t<1&&(t=1),t>60&&(t=60),A=t,g.dispatchEvent(Y)},this.getReverse=function(){return q},this.setReverse=function(e){q!==e&&(q=e,F=!1,e?g.dispatchEvent(X):g.dispatchEvent(W))},this.onComplete=function(){},this.play=function(e){void 0!==e?(e<0?e=0:e>h&&(e=h),C!==e&&(C=e,x||(F=!1,J()))):x||F||J()},this.pause=function(){x&&K()},this.destroyCanvas=function(){var e=g.parentNode;y||e.removeChild(g)},V(C)}var n,i,a,r=t.prototype;return r.addEventListener=function(e,t,n){this.canvas.addEventListener(e,t,n||!1)},r.removeEventListener=function(e,t,n){this.canvas.removeEventListener(e,t,n||!1)},r.destroy=function(){this.destroyCanvas()},n=t,(i=[{key:"every",get:function(){return this.getEvery()},set:function(e){this.setEvery(e)}},{key:"playing",get:function(){return this.getPlaying()}},{key:"transparency",get:function(){return this.getTransparency()},set:function(e){this.setTransparency(e)}},{key:"backward",get:function(){return this.getReverse()},set:function(e){this.setReverse(e)}},{key:"crossfade",get:function(){return this.getCrossfade()},set:function(e){this.setCrossfade(e)}}])&&e(n.prototype,i),a&&e(n,a),t}()}();
